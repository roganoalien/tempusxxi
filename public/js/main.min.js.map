{"version":3,"sources":["login.js"],"names":["LOGIN","_facebookListener","button","addEventListener","removeItems","document","querySelectorAll","i","length","parentNode","removeChild","parent","getElementById","div","createElement","className","appendChild","_addLoader","FB","login","response","console","log","status","_getSimpleData","authResponse","userID","accessToken","scope","id","token","api","concat","res","xhr","XMLHttpRequest","open","setRequestHeader","onload","respuesta","JSON","parse","responseText","querySelector","classList","add","setTimeout","window","location","href","url","send","encodeURI","picture","data","birthday","email","gender","name","isLogged","alert","loginListener","disabled"],"mappings":"aAAA,IAAMA,MAAS,WAQe,SAApBC,EAAoBC,GACtBA,EAAOC,iBAAiB,QAAS,WAE7B,IADA,IAAIC,EAAcC,SAASC,iBAAiB,eACnCC,EAAI,EAAGA,EAAIH,EAAYI,OAAQD,IACpCH,EAAYG,GAAGE,WAAWC,YAAYN,EAAYG,KAX3C,WACf,IAAII,EAASN,SAASO,eAAe,YACjCC,EAAMR,SAASS,cAAc,OACjCD,EAAIE,UAAY,OAChBJ,EAAOK,YAAYH,GASfI,GACAC,GAAGC,MACC,SAASC,GACLC,QAAQC,IAAIF,GACY,cAApBA,EAASG,QACTC,EACIJ,EAASK,aAAaC,OACtBN,EAASK,aAAaE,cAIlC,CACIC,MACI,+EA1BpB,IAgCMJ,EAAiB,SAACK,EAAIC,GACxBZ,GAAGa,IAAH,IAAAC,OACQH,EADR,oFAAAG,OAC6FF,GACzF,SAASG,GACLZ,QAAQC,IAAIW,GACZ,IAAIC,EAAM,IAAIC,eACdD,EAAIE,KAAK,OAAT,wBACAF,EAAIG,iBACA,eACA,qCAEJH,EAAII,OAAS,SAASlB,GAClB,GAAmB,MAAfc,EAAIX,OAAgB,CACpB,IAAIgB,EAAYC,KAAKC,MAAMP,EAAIQ,cACpBrC,SAASsC,cAAc,SAC7BC,UAAUC,IAAI,UACnBC,WAAW,WACPC,OAAOC,SAASC,KAAOV,EAAUW,KAClC,SACA,CACaV,KAAKC,MAAMP,EAAIQ,cAC/BK,OAAOC,SAASC,KAAO,MAG/B5B,QAAQC,IAAI,iBACZY,EAAIiB,KACAC,UAAS,UAAApB,OACKC,EAAIoB,QAAQC,KAAKJ,IADtB,cAAAlB,OAEDC,EAAIsB,SAFH,WAAAvB,OAGKC,EAAIuB,MAHT,YAAAxB,OAGyBC,EAAIwB,OAH7B,QAAAzB,OAIDC,EAAIJ,GAJH,cAAAG,OAKQC,EAAIe,SAASU,KALrB,UAAA1B,OAMDC,EAAIyB,KANH,WAAA1B,OAOKF,QAO9B,MAAO,CACH6B,SAAU,WACNC,MAAM,oBAEVC,cAAe,WACX,IAAI3D,EAASG,SAASO,eAAe,SACrCV,EAAO4D,UAAW,EAClB7D,EAAkBC,KAhFf","file":"main.min.js","sourcesContent":["const LOGIN = (function() {\n    const _addLoader = () => {\n        let parent = document.getElementById('appender');\n        let div = document.createElement('div');\n        div.className = 'wave';\n        parent.appendChild(div);\n    };\n\n    const _facebookListener = button => {\n        button.addEventListener('click', function() {\n            let removeItems = document.querySelectorAll('.removeItem');\n            for (let i = 0; i < removeItems.length; i++) {\n                removeItems[i].parentNode.removeChild(removeItems[i]);\n            }\n            _addLoader();\n            FB.login(\n                function(response) {\n                    console.log(response);\n                    if (response.status === 'connected') {\n                        _getSimpleData(\n                            response.authResponse.userID,\n                            response.authResponse.accessToken\n                        );\n                    }\n                },\n                {\n                    scope:\n                        'public_profile,email,user_status,user_birthday,user_gender,user_location'\n                }\n            );\n        });\n    };\n\n    const _getSimpleData = (id, token) => {\n        FB.api(\n            `/${id}?fields=id,birthday,email,name,gender,location,picture.type(large)&access_token=${token}`,\n            function(res) {\n                console.log(res);\n                let xhr = new XMLHttpRequest();\n                xhr.open('POST', `/users/facebook/save`);\n                xhr.setRequestHeader(\n                    'Content-Type',\n                    'application/x-www-form-urlencoded'\n                );\n                xhr.onload = function(response) {\n                    if (xhr.status === 200) {\n                        let respuesta = JSON.parse(xhr.responseText);\n                        let wave = document.querySelector('.wave');\n                        wave.classList.add('remove');\n                        setTimeout(function() {\n                            window.location.href = respuesta.url;\n                        }, 500);\n                    } else {\n                        let respuesta = JSON.parse(xhr.responseText);\n                        window.location.href = '/';\n                    }\n                };\n                console.log('se envía ajax');\n                xhr.send(\n                    encodeURI(\n                        `avatar=${res.picture.data.url}&birthday=${\n                            res.birthday\n                        }&email=${res.email}&gender=${res.gender}&id=${\n                            res.id\n                        }&location=${res.location.name}&name=${\n                            res.name\n                        }&token=${token}`\n                    )\n                );\n            }\n        );\n    };\n\n    return {\n        isLogged: function() {\n            alert('sesión iniciada');\n        },\n        loginListener: function() {\n            let button = document.getElementById('login');\n            button.disabled = false;\n            _facebookListener(button);\n        }\n    };\n})();\n"]}